---
import { SIDEBAR } from '../../config';

type Props = {
	currentPage: string;
};

const { currentPage } = Astro.props as Props;
const currentPageMatch = currentPage.endsWith('/')
	? currentPage.slice(1, -1)
	: currentPage.slice(1);
const sidebar = SIDEBAR;
---

<aside class="sticky top-20 col-span-1 hidden h-auto max-h-[calc(100vh-80px)] w-full flex-col justify-start overflow-y-auto md:top-24 md:flex md:max-h-[calc(100vh-96px)] md:pt-0">
  <nav>
    <ul class="nav-groups">
      {
        Object.entries(sidebar).map(([header, children]) => (
          <li>
            <div class="nav-group">
              <h2>{header}</h2>
              <ul>
                {children.map((child) => {
                  const url = `${Astro.site?.pathname}docs/${child.link}`;
                  return (
                    <li class="nav-link">
                      <a href={url} aria-current={currentPageMatch === child.link ? 'page' : false}>
                        {child.text}
                      </a>
                    </li>
                  );
                })}
              </ul>
            </div>
          </li>
        ))
      }
    </ul>
  </nav>
</aside>

<script is:inline>
	window.addEventListener('DOMContentLoaded', () => {
		var target = document.querySelector('[aria-current="page"]');
		if (target && target.offsetTop > window.innerHeight - 100) {
			document.querySelector('.nav-groups').scrollTop = target.offsetTop;
		}
	});
</script>
